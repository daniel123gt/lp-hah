---
import AccordionSimple from "../molecule/AccordionSimple.astro";
import { ACCORDION_PROCEDURE } from "../../consts";
---

<section class="bg-bg-light py-20">
  <div class="container mx-auto px-4">
    <div class="text-center mb-16">
      <h2 class="text-4xl font-bold text-primary-blue mb-6">
        Nuestros Procedimientos a Domicilio
      </h2>
      <p class="text-xl text-gray-600 max-w-3xl mx-auto">
        Amplia gama de procedimientos de enfermer√≠a especializados realizados con los m√°s altos est√°ndares de calidad y seguridad
      </p>
    </div>
    
    <!-- Filtros por categor√≠a -->
    <div class="flex flex-wrap justify-center gap-4 mb-12">
      <button 
        class="filter-btn active px-6 py-3 rounded-full bg-primary-blue text-white font-semibold hover:bg-accent-blue transition-all duration-300 shadow-lg hover:shadow-xl"
        data-category="todos"
      >
        üè• Todos los Procedimientos
      </button>
      <button 
        class="filter-btn px-6 py-3 rounded-full bg-white text-primary-blue font-semibold hover:bg-accent-blue hover:text-white transition-all duration-300 shadow-md hover:shadow-lg border border-primary-blue/20"
        data-category="tratamiento"
      >
        üíâ Tratamientos
      </button>
      <button 
        class="filter-btn px-6 py-3 rounded-full bg-white text-primary-blue font-semibold hover:bg-accent-blue hover:text-white transition-all duration-300 shadow-md hover:shadow-lg border border-primary-blue/20"
        data-category="monitoreo"
      >
        ‚ù§Ô∏è Monitoreo
      </button>
      <button 
        class="filter-btn px-6 py-3 rounded-full bg-white text-primary-blue font-semibold hover:bg-accent-blue hover:text-white transition-all duration-300 shadow-md hover:shadow-lg border border-primary-blue/20"
        data-category="cuidado"
      >
        ü©π Cuidados
      </button>
      <button 
        class="filter-btn px-6 py-3 rounded-full bg-white text-primary-blue font-semibold hover:bg-accent-blue hover:text-white transition-all duration-300 shadow-md hover:shadow-lg border border-primary-blue/20"
        data-category="procedimiento"
      >
        üîå Procedimientos
      </button>
      <button 
        class="filter-btn px-6 py-3 rounded-full bg-white text-primary-blue font-semibold hover:bg-accent-blue hover:text-white transition-all duration-300 shadow-md hover:shadow-lg border border-primary-blue/20"
        data-category="postoperatorio"
      >
        ‚úÇÔ∏è Postoperatorio
      </button>
    </div>

    <!-- Grid de acordeones -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6" id="accordion-grid">
      {
        ACCORDION_PROCEDURE.map((acc) => {
          return (
            <div class="accordion-wrapper" data-category={acc.category}>
              <AccordionSimple 
                title={acc.title} 
                icon={acc.icon}
                category={acc.category}
              >
                <p class="pt-4 text-lg leading-relaxed text-gray-700">{acc.description}</p>
              </AccordionSimple>
            </div>
          );
        })
      }
    </div>

    <!-- Informaci√≥n adicional -->
    <div class="text-center mt-16">
      <div class="bg-white p-8 rounded-2xl shadow-lg border border-primary-blue/20 max-w-4xl mx-auto">
        <h3 class="text-2xl font-semibold text-primary-blue mb-4">
          ¬øNecesita un Procedimiento Espec√≠fico?
        </h3>
        <p class="text-lg text-gray-600 mb-6">
          Si no encuentra el procedimiento que necesita en nuestra lista, no dude en contactarnos. Nuestro equipo de profesionales puede evaluar y realizar procedimientos especializados seg√∫n sus necesidades m√©dicas.
        </p>
        <div class="flex flex-wrap justify-center gap-4">
          <div class="flex items-center gap-2 text-primary-blue">
            <span class="text-xl">‚úÖ</span>
            <span class="font-medium">Protocolos de Seguridad</span>
          </div>
          <div class="flex items-center gap-2 text-primary-blue">
            <span class="text-xl">‚úÖ</span>
            <span class="font-medium">Personal Calificado</span>
          </div>
          <div class="flex items-center gap-2 text-primary-blue">
            <span class="text-xl">‚úÖ</span>
            <span class="font-medium">Equipos Especializados</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  // Funci√≥n para inicializar los filtros
  function initFilters() {
    const filterBtns = document.querySelectorAll<HTMLButtonElement>('.filter-btn');
    const accordionWrappers = document.querySelectorAll<HTMLDivElement>('.accordion-wrapper');
    
    // Limpiar event listeners anteriores
    filterBtns.forEach(btn => {
      const newBtn = btn.cloneNode(true) as HTMLButtonElement;
      btn.parentNode?.replaceChild(newBtn, btn);
    });
    
    // Obtener referencias frescas despu√©s del clonado
    const freshFilterBtns = document.querySelectorAll<HTMLButtonElement>('.filter-btn');
    const freshAccordionWrappers = document.querySelectorAll<HTMLDivElement>('.accordion-wrapper');
    
    freshFilterBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const category = btn.getAttribute('data-category');
        
        // Actualizar botones activos
        freshFilterBtns.forEach(b => {
          b.classList.remove('active', 'bg-primary-blue', 'text-white');
          b.classList.add('bg-gray-200', 'text-primary-blue');
        });
        btn.classList.add('active', 'bg-primary-blue', 'text-white');
        btn.classList.remove('bg-gray-200', 'text-primary-blue');
        
        // Filtrar acordeones
        freshAccordionWrappers.forEach(wrapper => {
          const wrapperCategory = wrapper.getAttribute('data-category');
          
          if (category === 'todos' || wrapperCategory === category) {
            wrapper.style.display = 'block';
            wrapper.style.animation = 'fadeIn 0.5s ease-in-out';
          } else {
            wrapper.style.display = 'none';
          }
        });
      });
    });
  }
  
  // Inicializar en la carga inicial
  document.addEventListener('DOMContentLoaded', () => {
    initFilters();
  });
  
  // Reinicializar en cada navegaci√≥n SPA
  document.addEventListener('astro:page-load', () => {
    // Peque√±o delay para asegurar que el DOM est√© listo
    setTimeout(() => {
      initFilters();
    }, 100);
  });
  
  // Limpiar antes de la navegaci√≥n
  document.addEventListener('astro:before-preparation', () => {
    // No es necesario limpiar nada aqu√≠ para este componente
  });
</script>

<style>
  .filter-btn.active {
    background-color: var(--color-primary-blue);
    color: white;
    box-shadow: 0 4px 12px rgba(30, 64, 175, 0.3);
  }
  
  .filter-btn:not(.active) {
    background-color: white;
    color: var(--color-primary-blue);
    border: 1px solid rgba(30, 64, 175, 0.2);
  }
  
  .filter-btn:not(.active):hover {
    background-color: var(--color-accent-blue);
    color: white;
    transform: translateY(-2px);
  }
  
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .accordion-wrapper {
    animation: fadeIn 0.5s ease-in-out;
  }
  
  /* Responsive adjustments */
  @media (max-width: 768px) {
    .filter-btn {
      font-size: 0.875rem;
      padding: 0.5rem 1rem;
    }
  }
</style>

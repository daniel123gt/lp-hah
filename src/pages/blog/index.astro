---
import BaseLayout from "../../layouts/BaseLayout.astro";
import HeroSubPage from "../../components/organism/HeroSubPage.astro";
import { getCollection } from 'astro:content';
import { Image } from 'astro:assets';
import img from "../../assets/images/enfermera-con-laptop.jpg";

// Obtener todos los posts del blog
const posts = await getCollection('blog');
// Ordenar por fecha de publicaci√≥n (m√°s reciente primero)
const sortedPosts = posts.sort((a: any, b: any) => new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime());
---

<BaseLayout>
  <HeroSubPage
    imgSrc={img}
    imgAlt="Blog de servicios m√©dicos y cuidados domiciliarios"
    title="Blog"
    subTitle="Informaci√≥n y Consejos de Salud"
    tagText="Blog de Salud"
    icon1="üìù"
    icon2="üí°"
    icon3="üìö"
    text1="Art√≠culos"
    text2="Consejos"
    text3="Informaci√≥n"
  />

  <!-- Lista de Posts del Blog -->
  <section class="container mx-auto py-[80px]">
    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
      {sortedPosts.map((post: any) => (
        <article class="bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-xl transition-all duration-300 hover:-translate-y-2 group">
          <!-- Imagen del Post -->
          <div class="relative">
            <img 
              src={post.data.image.replace('/src/assets/', '/lp-hah/')} 
              alt={post.data.title}
              class="w-full h-64 object-cover transition-transform duration-300 group-hover:scale-105"
              loading="lazy"
            />
            <!-- Tag de Categor√≠a -->
            <div class="absolute top-4 right-4">
              <span class="bg-gray-800 text-white text-xs px-3 py-1 rounded-full font-medium">
                {post.data.category}
              </span>
            </div>
          </div>
          
          <!-- Contenido del Post -->
          <div class="p-6">
            <h2 class="text-xl font-bold text-primary-blue mb-4 hover:underline cursor-pointer">
              <a href={`/lp-hah/blog/${post.slug}`} class="block">
                {post.data.title}
              </a>
            </h2>
            
            <p class="text-gray-600 leading-relaxed mb-6 line-clamp-3">
              {post.data.description}
            </p>
            
            <!-- Enlace Leer M√°s -->
            <a 
              href={`/lp-hah/blog/${post.slug}`}
              class="text-primary-blue font-semibold hover:underline inline-block mb-4 transition-colors duration-300 hover:text-accent-blue"
            >
              LEER M√ÅS
            </a>
            
            <!-- Metadata del Post -->
            <div class="flex items-center justify-between text-sm text-gray-500 pt-4 border-t border-gray-100">
              <time datetime={post.data.publishDate.toISOString()}>
                {post.data.publishDate.toLocaleDateString('es-ES', {
                  year: 'numeric',
                  month: 'long',
                  day: 'numeric'
                })}
              </time>
              <span>No hay comentarios</span>
            </div>
          </div>
          
          <!-- Overlay clickeable para toda la tarjeta -->
          <a 
            href={`/lp-hah/blog/${post.slug}`}
            class="absolute inset-0 z-10"
            aria-label={`Leer post: ${post.data.title}`}
          ></a>
        </article>
      ))}
    </div>
  </section>

  <!-- Call to Action -->
  <section class="bg-bg-light py-16">
    <div class="container mx-auto px-4 text-center">
      <h2 class="text-3xl font-bold text-primary-blue mb-6">
        ¬øQuiere Recibir Nuestros Art√≠culos?
      </h2>
      <p class="text-xl text-gray-600 mb-8 max-w-2xl mx-auto">
        Suscr√≠base a nuestro blog para recibir las √∫ltimas noticias sobre cuidados domiciliarios, 
        consejos de salud y novedades de nuestros servicios.
      </p>
      
      <a 
        href="https://api.whatsapp.com/send?phone=51961853894&text=Hola%2C%20quiero%20m√°s%20informaci√≥n%20sobre%20sus%20servicios%20m√©dicos%20a%20domicilio"
        target="_blank"
        class="inline-flex items-center gap-3 bg-primary-blue hover:bg-accent-blue text-white px-8 py-4 rounded-full text-lg font-semibold transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-xl"
      >
        <span>üìû</span>
        Contactar Ahora
      </a>
    </div>
  </section>
</BaseLayout>

<style>
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  /* Asegurar que el overlay no interfiera con el texto */
  article {
    position: relative;
  }
  
  /* Hacer que el contenido est√© por encima del overlay */
  article > div {
    position: relative;
    z-index: 20;
  }
</style>
